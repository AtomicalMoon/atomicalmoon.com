<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AtomicalMoon's portfolio: Expert in Blockbench texturing, modeling, and rendering. View projects and commission info.">
    <meta name="theme-color" content="#eeedeb">
    <meta property="og:title" content="AtomicalMoon - Portfolio">
    <meta property="og:description" content="Blockbench artist specializing in texturing, modeling, and rendering.">
    <meta property="og:type" content="website">
    <title>AtomicalMoon - Portfolio</title>
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="images/favicon-192.png">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">

    <script>
        (function() {
            if (localStorage.getItem('atomicalmoon-dark') === 'true') {
                document.documentElement.style.background = '#111113';
                document.documentElement.style.colorScheme = 'dark';
                var tc = document.querySelector('meta[name="theme-color"]');
                if (tc) tc.content = '#111113';
            }
        })();
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #eeedeb;
            --bg-warm: #e8e7e4;
            --bg-card: #f5f4f2;
            --bg-vanilla: #e3e2de;
            --border: rgba(140, 138, 130, 0.22);
            --border-hover: rgba(140, 138, 130, 0.4);
            --text-primary: #433e38;
            --text-secondary: #555450;
            --text-muted: #8a8880;
            --vanilla: #cecdca;
            --vanilla-dark: #a5a49c;
            --warm-white: #f3f2f0;
        }

        body.dark {
            --bg: #111113;
            --bg-warm: #161618;
            --bg-card: #1c1c1f;
            --bg-vanilla: #1a1a1d;
            --border: rgba(255, 60, 60, 0.1);
            --border-hover: rgba(255, 60, 60, 0.25);
            --text-primary: #e84040;
            --text-secondary: #b83030;
            --text-muted: #6e3030;
            --vanilla: #2a1a1a;
            --vanilla-dark: #8b3030;
            --warm-white: #0e0e10;
        }

        /* Dark mode overrides */
        body.dark .hero { background: linear-gradient(180deg, var(--warm-white) 0%, var(--bg) 100%); }
        body.dark .hero::before { background: radial-gradient(ellipse at top center, rgba(200, 40, 40, 0.08) 0%, transparent 65%); }
        body.dark .btn-primary { background: #cc2020; color: #111113; box-shadow: 0 2px 12px rgba(204, 32, 32, 0.2); }
        body.dark .btn-primary:hover { background: #b81c1c; box-shadow: 0 6px 24px rgba(204, 32, 32, 0.3); }
        body.dark .btn-soft { background: #2a1a1a; color: #e84040; border-color: rgba(255, 60, 60, 0.15); }
        body.dark .btn-soft:hover { background: #2e1c1c; }
        body.dark nav { background: rgba(17, 17, 19, 0.6); border-bottom-color: rgba(255, 60, 60, 0.08); }
        body.dark nav.scrolled { background: rgba(17, 17, 19, 0.92); }
        body.dark .nav-links a:hover { color: #e84040; background: rgba(255, 60, 60, 0.06); }
        body.dark footer { background: var(--warm-white); border-top-color: rgba(255, 60, 60, 0.08); }
        body.dark .status-open { color: #4ade80 !important; }
        body.dark .status-closed { color: #f87171 !important; }
        body.dark .status-full { color: #fbbf24 !important; }
        body.dark .status-waitlist { color: #60a5fa !important; }
        body.dark .status-paused { color: #c4b5fd !important; }
        body.dark .status-slots { color: #34d399 !important; }

        body.dark .hero-commission::before {
            background: linear-gradient(90deg, #3a1212, #f2d0d0, #dd3030, #1e0a0a, #f5e0e0, #bb2020, #3a1212, #f2d0d0);
            background-size: 300% 100%;
            animation: opalSlide 6s ease infinite;
        }
        body.dark .hero-commission .opal-shimmer {
            background: linear-gradient(270deg, transparent 0%, rgba(255, 190, 190, 0.6) 15%, rgba(220, 40, 40, 0.5) 25%, transparent 40%, transparent 60%, rgba(255, 210, 210, 0.6) 75%, rgba(200, 30, 30, 0.45) 85%, transparent 100%);
            background-size: 300% 100%;
            animation: opalShimmerSlide 5s ease infinite;
        }
        body.dark .hero-commission::after { background: var(--bg-card); }
        body.dark .hero-commission {
            box-shadow: 0 0 8px rgba(220, 40, 40, 0.3), 0 0 18px rgba(255, 190, 190, 0.15), 0 0 32px rgba(220, 40, 40, 0.1);
        }
        body.dark .nav-hamburger span { background: #b83030; }
        body.dark .hero-commission .comm-link { background: #2a1a1a; border-color: rgba(255, 60, 60, 0.12); color: #b83030; }
        body.dark .hero-commission .comm-link:hover { background: #2e1c1c; color: #e84040; }

        /* Dark mode toggle */
        .dark-toggle {
            position: fixed; bottom: 1.5rem; right: 1.5rem; z-index: 1001;
            width: 44px; height: 44px; border-radius: 50%;
            border: 1px solid var(--border); background: var(--bg-card);
            color: var(--text-secondary); cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.15rem; box-shadow: 0 2px 16px rgba(0,0,0,0.08);
            transition: transform 0.35s ease, box-shadow 0.35s ease;
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
        }
        .dark-toggle:hover { transform: scale(1.1); box-shadow: 0 4px 24px rgba(0,0,0,0.12); }
        body.dark .dark-toggle { box-shadow: 0 2px 16px rgba(200, 40, 40, 0.15); }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        img { max-width: 100%; height: auto; }
        html { scroll-behavior: smooth; overflow-x: hidden; width: 100%; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            background: var(--bg); color: var(--text-primary);
            line-height: 1.7; overflow-x: hidden; font-weight: 600;
            width: 100%; max-width: 100vw; overflow-wrap: break-word;
            text-rendering: optimizeSpeed;
        }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; scroll-behavior: auto !important; }
            .hero-slideshow, #bg-canvas { display: none !important; }
        }

        .status-open { color: #16a34a !important; }
        .status-closed { color: #dc2626 !important; }
        .status-full { color: #d97706 !important; }
        .status-waitlist { color: #2563eb !important; }
        .status-paused { color: #7c3aed !important; }
        .status-slots { color: #059669 !important; }

        #bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; }

        /* ===== NAV ===== */
        nav {
            position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
            padding: 1rem 2.5rem; display: flex; justify-content: space-between; align-items: center;
            background: rgba(250, 249, 246, 0.6); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border); transition: background 0.4s, box-shadow 0.4s;
        }
        nav.scrolled { background: rgba(250, 249, 246, 0.92); box-shadow: 0 1px 20px rgba(0,0,0,0.04); }
        .nav-logo { font-weight: 900; font-size: 1.5rem; color: var(--text-primary); letter-spacing: -0.03em; text-transform: uppercase; }
        .nav-links { display: flex; gap: 0.2rem; list-style: none; }
        .nav-links a { color: var(--text-secondary); text-decoration: none; padding: 0.45rem 1rem; border-radius: 100px; font-size: 0.82rem; font-weight: 700; letter-spacing: 0.03em; text-transform: uppercase; transition: color 0.3s, background 0.3s; }
        .nav-links a:hover { color: var(--text-primary); background: var(--vanilla); }
        .nav-hamburger { display: none; flex-direction: column; gap: 5px; cursor: pointer; padding: 4px; }
        .nav-hamburger span { width: 22px; height: 1.5px; background: var(--text-secondary); border-radius: 2px; }

        /* ===== HERO ===== */
        .hero {
            position: relative; min-height: 100vh;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; padding: 2rem 2rem 4rem; z-index: 1;
            background: linear-gradient(180deg, var(--warm-white) 0%, var(--bg) 100%);
            overflow: hidden;
        }
        .hero-slideshow { position: absolute; top: 0; left: 0; width: 100%; height: 120%; z-index: -2; opacity: 0.06; will-change: transform; }
        .hero-slideshow .slide { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 3s ease-in-out; will-change: opacity; }
        .hero-slideshow .slide.active { opacity: 1; }
        .hero::before { content: ''; position: absolute; top: -10%; left: 50%; transform: translateX(-50%); width: min(600px, 100%); height: 70%; background: radial-gradient(ellipse at top center, rgba(190, 188, 180, 0.3) 0%, transparent 65%); z-index: -1; pointer-events: none; }

        /* Hero logo image — the main title */
        .hero-title-wrap {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
            margin-bottom: 1.5rem;
            animation: fadeInUp 1s ease 0.1s both;
        }
        .hero-character {
            position: relative;
            width: clamp(320px, 55vw, 700px);
            height: auto;
            pointer-events: none;
        }
        .hero-character img {
            width: 100%; height: auto;
            object-fit: contain;
            -webkit-user-drag: none; user-drag: none;
        }
        .hero-character .char-light { display: block; }
        .hero-character .char-dark { display: none; }
        body.dark .hero-character .char-light { display: none; }
        body.dark .hero-character .char-dark { display: block; }
        .hero-subtitle { font-size: clamp(0.92rem, 2vw, 1.1rem); color: var(--text-secondary); max-width: 420px; font-weight: 700; letter-spacing: 0.03em; margin-bottom: 2.2rem; animation: fadeInUp 1s ease 0.25s both; position: relative; z-index: 2; }
        .hero-actions { display: flex; gap: 0.8rem; flex-wrap: wrap; justify-content: center; margin-bottom: 2rem; animation: fadeInUp 1s ease 0.4s both; position: relative; z-index: 2; }

        .btn { padding: 0.75rem 1.8rem; border-radius: 100px; text-decoration: none; font-weight: 800; font-size: 0.88rem; letter-spacing: 0.03em; transition: transform 0.35s ease, background 0.35s ease, box-shadow 0.35s ease; cursor: pointer; border: none; font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; }
        .btn-primary { background: #3e3d38; color: #eeedeb; box-shadow: 0 2px 12px rgba(62, 61, 56, 0.18); }
        .btn-primary:hover { transform: translateY(-2px); background: #32312c; box-shadow: 0 6px 24px rgba(62, 61, 56, 0.26); }
        .btn-soft { background: #b8b7b2; color: #2a2925; border: 1px solid rgba(140, 138, 130, 0.3); }
        .btn-soft:hover { background: #a8a7a2; transform: translateY(-1px); }

        /* Commission pill */
        .hero-commission {
            display: flex; align-items: center; gap: 0.8rem; padding: 0.6rem 1.4rem;
            border-radius: 100px; background: var(--bg-card); border: 1px solid var(--border);
            animation: fadeInUp 1s ease 0.55s both;
            flex-wrap: wrap; justify-content: center; position: relative; z-index: 1; max-width: 100%;
        }
        .hero-commission::before { content: ''; position: absolute; top: -6px; left: -6px; right: -6px; bottom: -6px; border-radius: 106px; background: linear-gradient(90deg, #d4b8e8, #b8d4f0, #e8b8d8, #b8e8d4, #e0c8f0, #b8d8e8, #f0c0d8, #c0e8d0, #d4b8e8); background-size: 300% 100%; z-index: -2; animation: opalSlide 6s ease infinite; }
        .hero-commission .opal-shimmer { position: absolute; top: -6px; left: -6px; right: -6px; bottom: -6px; border-radius: 106px; z-index: -2; background: linear-gradient(270deg, transparent 0%, rgba(190, 150, 230, 0.6) 15%, rgba(140, 200, 240, 0.55) 25%, transparent 40%, transparent 60%, rgba(240, 160, 200, 0.6) 75%, rgba(150, 230, 190, 0.5) 85%, transparent 100%); background-size: 300% 100%; animation: opalShimmerSlide 5s ease infinite; pointer-events: none; }
        @keyframes opalSlide { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes opalShimmerSlide { 0% { background-position: 100% 50%; } 50% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }
        .hero-commission::after { content: ''; position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px; border-radius: 102px; background: var(--bg-card); z-index: -1; }
        .hero-commission { box-shadow: 0 0 10px rgba(212, 184, 232, 0.35), 0 0 22px rgba(184, 212, 240, 0.25), 0 0 36px rgba(232, 184, 216, 0.15); animation: fadeInUp 1s ease 0.55s both, opalOuterGlow 5s ease infinite; }
        @keyframes opalOuterGlow { 0%, 100% { box-shadow: 0 0 10px rgba(212, 184, 232, 0.38), 0 0 24px rgba(184, 212, 240, 0.25), 0 0 40px rgba(240, 192, 216, 0.14); } 33% { box-shadow: 0 0 10px rgba(184, 232, 212, 0.38), 0 0 24px rgba(224, 200, 240, 0.25), 0 0 40px rgba(184, 216, 232, 0.14); } 66% { box-shadow: 0 0 10px rgba(240, 192, 216, 0.38), 0 0 24px rgba(192, 232, 208, 0.25), 0 0 40px rgba(212, 184, 232, 0.14); } }
        .hero-commission .comm-label { font-size: 0.82rem; color: var(--text-muted); font-weight: 500; }
        .hero-commission #status-text { font-weight: 700; font-size: 0.85rem; letter-spacing: 0.05em; transition: color 0.3s; }
        .hero-commission .comm-link { font-size: 0.78rem; color: var(--text-secondary); text-decoration: none; font-weight: 600; padding: 0.25rem 0.7rem; border-radius: 100px; background: var(--bg-vanilla); border: 1px solid var(--border); transition: background 0.3s, color 0.3s; }
        .hero-commission .comm-link:hover { background: var(--vanilla); color: var(--text-primary); }

        .scroll-indicator { position: absolute; bottom: 2rem; left: 50%; transform: translateX(-50%); display: flex; flex-direction: column; align-items: center; gap: 0.5rem; animation: fadeInUp 1s ease 0.8s both; }
        .scroll-indicator span { font-size: 0.6rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--text-muted); }
        .scroll-line { width: 1px; height: 32px; background: linear-gradient(to bottom, var(--text-muted), transparent); animation: scrollPulse 2s ease infinite; }
        @keyframes scrollPulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }

        /* ===== GALLERY SECTION ===== */
        .gallery-section { position: relative; z-index: 1; padding: 4rem 0 0; }
        .gallery-header { text-align: center; padding: 0 2rem 2rem; }
        .section-label { display: inline-block; font-size: 0.72rem; font-weight: 800; letter-spacing: 0.18em; text-transform: uppercase; color: var(--vanilla-dark); margin-bottom: 0.5rem; }
        .section-title { font-size: clamp(1.8rem, 4vw, 2.6rem); font-weight: 900; letter-spacing: -0.03em; text-transform: uppercase; margin-bottom: 0.5rem; }
        .section-desc { color: var(--text-secondary); font-weight: 500; font-size: 0.92rem; max-width: 420px; margin: 0 auto; }

        /* Filter bar */
        .filter-bar {
            padding: 1.2rem 2rem; display: flex; flex-wrap: wrap; gap: 0.5rem; align-items: center;
            border-top: 1px solid var(--border); border-bottom: 1px solid var(--border);
            background: var(--bg-warm);
        }
        .filter-bar-label { font-size: 0.72rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-muted); margin-right: 0.5rem; }
        .filter-tag { padding: 0.35rem 0.85rem; border-radius: 100px; background: var(--bg-card); border: 1px solid var(--border); font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); cursor: pointer; transition: background 0.25s ease, color 0.25s ease, border-color 0.25s ease; text-transform: uppercase; letter-spacing: 0.03em; }
        .filter-tag:hover { border-color: var(--border-hover); color: var(--text-primary); }
        .filter-tag.active { background: var(--text-primary); color: var(--bg); border-color: var(--text-primary); }
        body.dark .filter-tag.active { background: #e84040; color: #111113; border-color: #e84040; }

        /* ★ COMMISSION filter tag — flashy opal with pulse glow */
        .filter-tag[data-tag="commission"] { position: relative; z-index: 0; overflow: visible; }
        .filter-tag[data-tag="commission"]::before {
            content: ''; position: absolute; top: -4px; left: -4px; right: -4px; bottom: -4px;
            border-radius: 100px;
            background: linear-gradient(90deg, #c070f0, #70c0f0, #f070b0, #70f0c0, #c070f0);
            background-size: 300% 100%; z-index: -1; animation: opalSlide 3s ease infinite;
            filter: blur(1px);
        }
        .filter-tag[data-tag="commission"]::after {
            content: ''; position: absolute; top: -1px; left: -1px; right: -1px; bottom: -1px;
            border-radius: 100px; background: var(--bg-card); z-index: -1;
        }
        .filter-tag[data-tag="commission"].active::after { background: transparent; }
        .filter-tag[data-tag="commission"].active {
            background: transparent; color: #1a1a2e; border-color: transparent;
            text-shadow: 0 0 6px rgba(255,255,255,0.5);
            font-weight: 900;
        }
        .filter-tag[data-tag="commission"].active::before { opacity: 1; top: 0; left: 0; right: 0; bottom: 0; filter: none; }
        body.dark .filter-tag[data-tag="commission"]::before { background: linear-gradient(90deg, #ff3333, #ffb0b0, #cc2020, #ffd0d0, #ff3333); background-size: 300% 100%; }
        body.dark .filter-tag[data-tag="commission"]::after { background: var(--bg-card); }
        body.dark .filter-tag[data-tag="commission"].active::after { background: transparent; }
        body.dark .filter-tag[data-tag="commission"].active { color: #1a0808; text-shadow: 0 0 6px rgba(255,200,200,0.5); }

        .gallery-count { padding: 0.8rem 2rem; font-size: 0.72rem; font-weight: 700; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.06em; }

        /* Masonry */
        .masonry { padding: 0.5rem 2rem 4rem; column-count: 4; column-gap: 0.8rem; -webkit-user-select: none; user-select: none; }
        .masonry-item {
            break-inside: avoid; margin-bottom: 0.8rem; border-radius: 10px; overflow: hidden;
            position: relative; cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            -webkit-touch-callout: none; background: var(--bg-vanilla); min-height: 80px;
            border: 1px solid var(--border); box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            contain: layout style paint;
        }
        body.dark .masonry-item { border-color: rgba(255, 255, 255, 0.08); box-shadow: 0 2px 8px rgba(0,0,0,0.3); background: #1a1a1d; }

        /* ★ COMMISSION gallery items — animated rainbow opal border + sparkle */
        .masonry-item.is-commission {
            border: none;
            outline: 3px solid transparent;
            outline-offset: -1px;
            position: relative;
            margin-bottom: 1.4rem;
        }
        .masonry-item.is-commission {
            box-shadow:
                0 0 0 3px rgba(192, 112, 240, 0.5),
                0 0 16px rgba(192, 112, 240, 0.3),
                0 0 32px rgba(112, 192, 240, 0.2),
                0 0 52px rgba(240, 112, 176, 0.12);
            animation: commItemGlow 4s ease infinite;
        }
        @keyframes commItemGlow {
            0%, 100% {
                box-shadow:
                    0 0 0 3px rgba(192, 112, 240, 0.5),
                    0 0 16px rgba(192, 112, 240, 0.35),
                    0 0 32px rgba(112, 192, 240, 0.2),
                    0 0 52px rgba(240, 112, 176, 0.12);
            }
            25% {
                box-shadow:
                    0 0 0 3px rgba(112, 192, 240, 0.5),
                    0 0 18px rgba(112, 240, 192, 0.35),
                    0 0 34px rgba(224, 160, 255, 0.22),
                    0 0 54px rgba(128, 208, 240, 0.14);
            }
            50% {
                box-shadow:
                    0 0 0 3px rgba(240, 112, 176, 0.5),
                    0 0 20px rgba(240, 128, 192, 0.38),
                    0 0 36px rgba(112, 192, 240, 0.24),
                    0 0 56px rgba(192, 112, 240, 0.15);
            }
            75% {
                box-shadow:
                    0 0 0 3px rgba(112, 240, 192, 0.5),
                    0 0 18px rgba(128, 208, 240, 0.35),
                    0 0 34px rgba(240, 112, 176, 0.22),
                    0 0 54px rgba(112, 240, 192, 0.14);
            }
        }
        body.dark .masonry-item.is-commission {
            box-shadow:
                0 0 0 3px rgba(255, 51, 51, 0.5),
                0 0 18px rgba(255, 51, 51, 0.35),
                0 0 36px rgba(255, 176, 176, 0.2),
                0 0 56px rgba(204, 32, 32, 0.12);
            animation: commItemGlowDark 3s ease infinite;
        }
        @keyframes commItemGlowDark {
            0%, 100% {
                box-shadow:
                    0 0 0 3px rgba(255, 51, 51, 0.5),
                    0 0 18px rgba(255, 51, 51, 0.35),
                    0 0 36px rgba(255, 176, 176, 0.2),
                    0 0 56px rgba(204, 32, 32, 0.12);
            }
            50% {
                box-shadow:
                    0 0 0 3px rgba(255, 100, 100, 0.65),
                    0 0 28px rgba(255, 51, 51, 0.55),
                    0 0 48px rgba(255, 176, 176, 0.32),
                    0 0 70px rgba(204, 32, 32, 0.2);
            }
        }

        /* Loading shimmer */
        .masonry-item.loading::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(90deg, var(--bg-vanilla) 25%, var(--bg-card) 50%, var(--bg-vanilla) 75%); background-size: 200% 100%; animation: shimmerLoad 1.5s ease infinite; z-index: 0; border-radius: 10px; }
        .masonry-item.loaded::before { display: none; }
        .masonry-item.loading img { opacity: 0; }
        .masonry-item.loaded img { opacity: 1; transition: opacity 0.4s ease; }
        @keyframes shimmerLoad { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        /* Watermark overlay */
        .masonry-item::after { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 1; background-image: var(--watermark-pattern); background-repeat: repeat; opacity: var(--watermark-opacity, 0.15); pointer-events: auto; }

        .masonry-item:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,0.08); border-color: var(--border-hover); }
        body.dark .masonry-item:hover { box-shadow: 0 8px 24px rgba(200, 40, 40, 0.12); border-color: rgba(255, 255, 255, 0.15); }
        .masonry-item.is-commission:hover {
            transform: translateY(-5px) scale(1.01);
            box-shadow:
                0 0 0 3px rgba(192, 112, 240, 0.65),
                0 0 24px rgba(192, 112, 240, 0.5),
                0 0 48px rgba(112, 192, 240, 0.35),
                0 12px 36px rgba(0,0,0,0.12);
        }
        body.dark .masonry-item.is-commission:hover {
            box-shadow:
                0 0 0 3px rgba(255, 80, 80, 0.7),
                0 0 28px rgba(255, 51, 51, 0.55),
                0 0 56px rgba(255, 176, 176, 0.3),
                0 12px 36px rgba(200, 40, 40, 0.2);
        }

        .masonry-item img { width: 100%; display: block; border-radius: 9px; min-height: 80px; -webkit-user-drag: none; user-drag: none; pointer-events: none; }
        .masonry-item .item-tags { position: absolute; bottom: 0.5rem; left: 0.5rem; display: flex; gap: 0.3rem; flex-wrap: wrap; z-index: 2; pointer-events: none; }
        .masonry-item .item-tag { padding: 0.2rem 0.55rem; border-radius: 100px; background: rgba(60, 60, 60, 0.7); backdrop-filter: blur(8px); font-size: 0.62rem; font-weight: 800; color: #fff; text-transform: uppercase; letter-spacing: 0.04em; border: 1px solid rgba(255, 255, 255, 0.15); }
        body.dark .masonry-item .item-tag { border-color: rgba(255, 255, 255, 0.1); }

        /* ★ Commission tag badge — animated opal with pulse + sparkle */
        .masonry-item .item-tag.tag-commission {
            background: linear-gradient(90deg, #c070f0, #70c0f0, #f070b0, #70f0c0, #c070f0);
            background-size: 300% 100%; animation: opalSlide 3s ease infinite;
            color: #fff; border-color: rgba(255, 255, 255, 0.5);
            font-weight: 900; letter-spacing: 0.08em;
            text-shadow: 0 0 8px rgba(255,255,255,0.5), 0 1px 2px rgba(0,0,0,0.2);
            padding: 0.25rem 0.7rem;
            font-size: 0.64rem;
            box-shadow: 0 0 10px rgba(192, 112, 240, 0.4), 0 0 20px rgba(112, 192, 240, 0.2);
            animation: opalSlide 3s ease infinite, commTagPulse 2s ease infinite;
        }
        @keyframes commTagPulse {
            0%, 100% { box-shadow: 0 0 8px rgba(192, 112, 240, 0.35), 0 0 18px rgba(112, 192, 240, 0.15); }
            50% { box-shadow: 0 0 14px rgba(192, 112, 240, 0.55), 0 0 28px rgba(112, 192, 240, 0.3); }
        }
        body.dark .masonry-item .item-tag.tag-commission {
            background: linear-gradient(90deg, #ff3333, #ffb0b0, #cc2020, #ffd0d0, #ff3333);
            background-size: 300% 100%;
            color: #fff; border-color: rgba(255, 200, 200, 0.5);
            text-shadow: 0 0 8px rgba(255,100,100,0.5), 0 1px 2px rgba(0,0,0,0.3);
            box-shadow: 0 0 10px rgba(255, 51, 51, 0.4), 0 0 20px rgba(255, 176, 176, 0.2);
            animation: opalSlide 3s ease infinite, commTagPulseDark 2s ease infinite;
        }
        @keyframes commTagPulseDark {
            0%, 100% { box-shadow: 0 0 8px rgba(255, 51, 51, 0.35), 0 0 18px rgba(255, 176, 176, 0.15); }
            50% { box-shadow: 0 0 14px rgba(255, 51, 51, 0.6), 0 0 28px rgba(255, 176, 176, 0.35); }
        }

        .masonry-item.hidden { display: none; }

        /* Lightbox */
        .lightbox { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.92); z-index: 2000; align-items: center; justify-content: center; cursor: pointer; }
        .lightbox.open { display: flex; }
        .lightbox img { max-width: 85vw; max-height: 85vh; object-fit: contain; border-radius: 8px; -webkit-user-drag: none; user-drag: none; pointer-events: none; -webkit-touch-callout: none; transition: opacity 0.25s ease; }
        .lightbox img.lb-loading { opacity: 0.3; }
        .lightbox::after { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 1; background-image: var(--watermark-pattern); background-repeat: repeat; opacity: var(--watermark-opacity, 0.15); pointer-events: none; }
        .lightbox-close { position: absolute; top: 1.5rem; right: 1.5rem; color: #fff; font-size: 1.5rem; font-weight: 900; cursor: pointer; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; border-radius: 50%; background: rgba(255,255,255,0.1); transition: background 0.2s; z-index: 10; }
        .lightbox-close:hover { background: rgba(255,255,255,0.25); }

        /* Lightbox nav arrows */
        .lb-arrow {
            position: absolute; top: 50%; transform: translateY(-50%);
            width: 48px; height: 48px; border-radius: 50%;
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.15);
            color: #fff; font-size: 1.4rem; font-weight: 900;
            cursor: pointer; z-index: 10;
            display: flex; align-items: center; justify-content: center;
            transition: background 0.25s ease, transform 0.25s ease;
            backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
        }
        .lb-arrow:hover { background: rgba(255,255,255,0.25); transform: translateY(-50%) scale(1.08); }
        .lb-arrow-prev { left: 1.5rem; }
        .lb-arrow-next { right: 1.5rem; }
        .lb-counter {
            position: absolute; bottom: 1.5rem; left: 50%; transform: translateX(-50%);
            color: rgba(255,255,255,0.5); font-size: 0.72rem; font-weight: 700;
            letter-spacing: 0.08em; z-index: 10;
        }

        /* Search input */
        .gallery-search {
            padding: 0.35rem 0.9rem; border-radius: 100px;
            background: var(--bg-card); border: 1px solid var(--border);
            font-size: 0.75rem; font-weight: 600; color: var(--text-primary);
            outline: none; width: 140px; transition: width 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            font-family: 'Inter', sans-serif; margin-left: auto;
        }
        .gallery-search::placeholder { color: var(--text-muted); font-weight: 600; }
        .gallery-search:focus { border-color: var(--border-hover); width: 180px; box-shadow: 0 0 0 3px rgba(140, 138, 130, 0.08); }
        body.dark .gallery-search:focus { box-shadow: 0 0 0 3px rgba(255, 60, 60, 0.06); }

        /* Tag count badges */
        .filter-tag .tag-count {
            display: inline-block; margin-left: 0.3rem;
            font-size: 0.6rem; opacity: 0.55; font-weight: 800;
        }

        /* Back to top */
        .back-to-top {
            position: fixed; bottom: 1.5rem; left: 1.5rem;
            z-index: 1001; width: 44px; height: 44px;
            border-radius: 50%; border: 1px solid var(--border);
            background: var(--bg-card); color: var(--text-secondary);
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 1.1rem; font-weight: 900;
            box-shadow: 0 2px 16px rgba(0,0,0,0.08);
            transition: opacity 0.35s ease, transform 0.35s ease, box-shadow 0.35s ease;
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            opacity: 0; pointer-events: none; transform: translateY(8px);
        }
        .back-to-top.visible { opacity: 1; pointer-events: auto; transform: translateY(0); }
        .back-to-top:hover { transform: translateY(-2px); box-shadow: 0 4px 24px rgba(0,0,0,0.12); }
        body.dark .back-to-top { box-shadow: 0 2px 16px rgba(200, 40, 40, 0.15); }

        /* Commission status skeleton */
        .status-skeleton {
            display: inline-block; width: 52px; height: 14px;
            background: linear-gradient(90deg, var(--bg-vanilla) 25%, var(--bg-card) 50%, var(--bg-vanilla) 75%);
            background-size: 200% 100%; animation: shimmerLoad 1.5s ease infinite;
            border-radius: 4px; vertical-align: middle;
        }

        .empty-state { text-align: center; padding: 4rem 2rem; color: var(--text-muted); font-weight: 700; font-size: 0.9rem; }

        /* ===== DIVIDER ===== */
        .divider { height: 1px; margin: 0 2rem; background: linear-gradient(to right, transparent, var(--border), transparent); }
        body.dark .divider { background: linear-gradient(to right, transparent, rgba(200, 40, 40, 0.15), transparent); }

        /* ===== CONTACT ===== */
        .section { position: relative; z-index: 1; padding: 5.5rem 2rem; overflow: hidden; content-visibility: auto; contain-intrinsic-size: auto 400px; }
        .section-inner { max-width: 1000px; margin: 0 auto; }
        .contact-cards { text-align: center; }
        .contact-desc { color: var(--text-secondary); font-size: 0.95rem; font-weight: 500; max-width: 420px; margin: 0 auto 2rem; line-height: 1.6; }
        .contact-links { display: flex; gap: 1.2rem; justify-content: center; flex-wrap: wrap; }
        .contact-card { display: flex; align-items: center; gap: 1rem; padding: 1.3rem 1.8rem; border-radius: 16px; background: var(--bg-card); border: 1px solid var(--border); text-decoration: none; color: var(--text-primary); transition: transform 0.35s ease, box-shadow 0.35s ease, border-color 0.35s ease; box-shadow: 0 1px 8px rgba(0,0,0,0.03); min-width: 260px; }
        .contact-card:hover { border-color: var(--border-hover); transform: translateY(-3px); box-shadow: 0 8px 28px rgba(0,0,0,0.06); }
        body.dark .contact-card:hover { box-shadow: 0 8px 28px rgba(200, 40, 40, 0.08); }
        .contact-card-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; background: var(--bg-vanilla); border: 1px solid var(--border); color: var(--text-secondary); flex-shrink: 0; }
        .contact-card-text { flex: 1; text-align: left; }
        .contact-card-text h3 { font-weight: 800; font-size: 1rem; text-transform: uppercase; letter-spacing: -0.01em; }
        .contact-card-text p { font-size: 0.78rem; color: var(--text-muted); font-weight: 600; }
        .contact-card-arrow { color: var(--text-muted); font-size: 1.2rem; font-weight: 700; transition: transform 0.3s, color 0.3s; flex-shrink: 0; }
        .contact-card:hover .contact-card-arrow { color: var(--text-primary); transform: translateX(3px); }

        /* ===== FOOTER ===== */
        footer { position: relative; z-index: 1; text-align: center; padding: 2.5rem 2rem; border-top: 1px solid var(--border); background: var(--warm-white); }
        footer .footer-logo { font-weight: 900; text-transform: uppercase; letter-spacing: -0.02em; font-size: 1rem; color: var(--text-secondary); margin-bottom: 0.3rem; }
        footer p { color: var(--text-muted); font-size: 0.78rem; }
        footer .footer-socials { display: flex; justify-content: center; gap: 1.5rem; margin-top: 0.6rem; }
        footer .footer-socials a { color: var(--text-muted); text-decoration: none; font-size: 0.78rem; font-weight: 500; transition: color 0.3s; }
        footer .footer-socials a:hover { color: var(--text-primary); }

        /* ===== ANIMATIONS ===== */
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(18px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .reveal { opacity: 0; transform: translateY(24px); transition: opacity 0.8s ease, transform 0.8s ease; }
        .reveal.visible { opacity: 1; transform: translateY(0); }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1000px) { .masonry { column-count: 3; } }
        @media (max-width: 768px) {
            .nav-links { display: none; }
            .nav-links.open { display: flex; flex-direction: column; position: absolute; top: 100%; left: 0; right: 0; background: rgba(238, 237, 235, 0.97); backdrop-filter: blur(20px); padding: 1rem; border-bottom: 1px solid var(--border); }
            body.dark .nav-links.open { background: rgba(17, 17, 19, 0.97); }
            .nav-hamburger { display: flex; }
            nav { padding: 0.8rem 1rem; }
            .nav-logo { font-size: 1.15rem; }
            .hero { padding: 1.5rem 1.2rem 3rem; }
            .hero-character { width: clamp(240px, 70vw, 400px); }
            .hero-subtitle { font-size: 0.85rem; max-width: 100%; padding: 0 0.5rem; }
            .hero-actions { gap: 0.6rem; }
            .btn { padding: 0.65rem 1.3rem; font-size: 0.8rem; }
            .hero-commission { flex-direction: column; gap: 0.4rem; padding: 0.5rem 1rem; max-width: calc(100% - 2rem); border-radius: 16px; }
            .hero-commission::before { border-radius: 20px; top: -4px; left: -4px; right: -4px; bottom: -4px; }
            .hero-commission::after { border-radius: 18px; top: -2px; left: -2px; right: -2px; bottom: -2px; }
            .hero-commission .opal-shimmer { top: -4px; left: -4px; right: -4px; bottom: -4px; border-radius: 20px; }
            .section { padding: 3rem 1.2rem; }
            .section-inner { padding: 0; }
            .section-title { font-size: clamp(1.5rem, 5vw, 2.2rem); }
            .section-desc { font-size: 0.82rem; max-width: 100%; }
            .masonry { column-count: 2; padding: 0.5rem 1rem 4rem; }
            .filter-bar { padding: 1rem; overflow-x: auto; flex-wrap: nowrap; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
            .filter-bar::-webkit-scrollbar { display: none; }
            .filter-tag { flex-shrink: 0; }
            .contact-links { flex-direction: column; align-items: stretch; }
            .contact-card { min-width: 0; }
            footer { padding: 2rem 1.2rem; }
            .dark-toggle { bottom: 1rem; right: 1rem; width: 40px; height: 40px; font-size: 1rem; }
            .back-to-top { bottom: 1rem; left: 1rem; width: 40px; height: 40px; font-size: 1rem; }
            .lb-arrow { width: 38px; height: 38px; font-size: 1.1rem; }
            .lb-arrow-prev { left: 0.6rem; }
            .lb-arrow-next { right: 0.6rem; }
            .gallery-search { width: 100px; font-size: 0.7rem; }
            .gallery-search:focus { width: 130px; }
            .scroll-indicator { display: none; }
            .gallery-section { padding: 3rem 0 0; }
            .divider { margin: 0 1.2rem; }
        }
        @media (max-width: 450px) { .masonry { column-count: 1; } }
        @media (max-width: 380px) {
            .hero-character { width: 220px; }
            .nav-logo { font-size: 1rem; }
            .hero-actions { flex-direction: column; width: 100%; }
            .btn { width: 100%; text-align: center; }
            .section { padding: 2.5rem 1rem; }
            .section-title { font-size: 1.3rem; }
        }
    </style>
</head>
<body>

    <canvas id="bg-canvas"></canvas>

    <button class="dark-toggle" id="dark-toggle" aria-label="Toggle dark mode" title="Toggle dark mode">
        <span id="toggle-icon">&#9790;</span>
    </button>

    <button class="back-to-top" id="back-to-top" aria-label="Back to top" title="Back to top">&#8593;</button>

    <!-- NAV -->
    <nav id="main-nav">
        <div class="nav-logo">AtomicalMoon</div>
        <ul class="nav-links" id="nav-links">
            <li><a href="#portfolio">Portfolio</a></li>
            <li><a href="commissions.html">Commissions</a></li>
            <li><a href="#contact">Contact</a></li>
        </ul>
        <div class="nav-hamburger" id="nav-hamburger" aria-label="Toggle menu">
            <span></span><span></span><span></span>
        </div>
    </nav>

    <!-- HERO -->
    <section class="hero" id="hero">
        <div class="hero-slideshow">
            <img src="images/hero1.png" alt="Hero Image 1" class="slide active" fetchpriority="high" decoding="async">
            <img src="images/hero2.png" alt="Hero Image 2" class="slide" loading="lazy" decoding="async">
            <img src="images/hero3.png" alt="Hero Image 3" class="slide" loading="lazy" decoding="async">
        </div>
        <div class="hero-title-wrap">
            <div class="hero-character">
                <img src="images/brightmoon.png" alt="AtomicalMoon" class="char-light" fetchpriority="high" decoding="async">
                <img src="images/darkmoon.png" alt="AtomicalMoon" class="char-dark" loading="lazy" decoding="async">
            </div>
        </div>
        <p class="hero-subtitle">Texturer - Renderer - Modeler</p>
        <div class="hero-actions">
            <a href="#portfolio" class="btn btn-primary">View Portfolio</a>
            <a href="#contact" class="btn btn-soft">Get in Touch</a>
        </div>
        <div class="hero-commission">
            <div class="opal-shimmer"></div>
            <span class="comm-label">Commissions:</span>
            <span id="status-text"><span class="status-skeleton"></span></span>
            <a href="commissions.html" class="comm-link">View Info &rarr;</a>
        </div>
        <div class="scroll-indicator">
            <span>Scroll</span>
            <div class="scroll-line"></div>
        </div>
    </section>

    <div class="divider"></div>

    <!-- GALLERY -->
    <section class="gallery-section" id="portfolio">
        <div class="gallery-header">
            <span class="section-label reveal">Portfolio</span>
            <h2 class="section-title reveal">Explore My Work</h2>
            <p class="section-desc reveal">Browse through my projects and commissioned pieces.</p>
        </div>

        <div class="filter-bar" id="filter-bar">
            <span class="filter-bar-label">Filter:</span>
            <button class="filter-tag active" data-tag="all">All</button>
            <input type="text" class="gallery-search" id="gallery-search" placeholder="Search tags...">
        </div>

        <div class="gallery-count" id="gallery-count"></div>
        <div class="masonry" id="masonry"></div>
        <div class="empty-state" id="empty-state" style="display:none;">No images found. Add images to <code>collage/images/</code> and update <code>images.json</code>.</div>
    </section>

    <div class="lightbox" id="lightbox">
        <div class="lightbox-close" id="lightbox-close">&times;</div>
        <div class="lb-arrow lb-arrow-prev" id="lb-prev">&#8249;</div>
        <div class="lb-arrow lb-arrow-next" id="lb-next">&#8250;</div>
        <img id="lightbox-img" src="" alt="">
        <div class="lb-counter" id="lb-counter"></div>
    </div>

    <div class="divider"></div>

    <!-- CONTACT -->
    <section class="section" id="contact">
        <div class="section-inner">
            <span class="section-label reveal">Contact</span>
            <h2 class="section-title reveal">Let's Work Together</h2>
            <div class="contact-cards reveal">
                <p class="contact-desc">Interested in a commission or want to chat? Reach out to me directly through DMs.</p>
                <div class="contact-links" id="contact-links"></div>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer>
        <p class="footer-logo">AtomicalMoon</p>
        <p>&copy; <span id="year"></span> AtomicalMoon. All rights reserved.</p>
        <div class="footer-socials" id="footer-socials"></div>
    </footer>

    <script>
        // Dark mode
        var darkToggle = document.getElementById('dark-toggle');
        var toggleIcon = document.getElementById('toggle-icon');
        var isDark = localStorage.getItem('atomicalmoon-dark') === 'true';
        function setDarkMode(on) {
            document.body.classList.toggle('dark', on);
            toggleIcon.innerHTML = on ? '&#9788;' : '&#9790;';
            localStorage.setItem('atomicalmoon-dark', on ? 'true' : 'false');
            isDark = on;
        }
        setDarkMode(isDark);
        darkToggle.addEventListener('click', function() { setDarkMode(!isDark); });
        document.getElementById('year').textContent = new Date().getFullYear();

        // Social icons
        var socialIcons = {
            discord: '<svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.095 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.095 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/></svg>',
            twitter: '<svg width="26" height="26" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>',
            youtube: '<svg width="26" height="26" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>',
            github: '<svg width="26" height="26" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>',
            instagram: '<svg width="26" height="26" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 1 0 0 12.324 6.162 6.162 0 0 0 0-12.324zM12 16a4 4 0 1 1 0-8 4 4 0 0 1 0 8zm6.406-11.845a1.44 1.44 0 1 0 0 2.881 1.44 1.44 0 0 0 0-2.881z"/></svg>'
        };
        var socialDescriptions = { discord: 'DM me for commissions', twitter: 'Follow and message me', youtube: 'Watch my content', github: 'Check out my repos', instagram: 'See my posts' };

        // ===== PARALLEL DATA LOADING =====
        var _v = '1'; // bump this when config changes, or remove for no-cache
        var fetchJSON = function(url) { return fetch(url).then(function(r) { return r.ok ? r.json() : null; }).catch(function() { return null; }); };

        Promise.all([
            fetchJSON('config/socials.json?v=' + _v),
            fetchJSON('config/commission-status.json?v=' + _v),
            fetchJSON('config/watermark.json?v=' + _v),
            fetchJSON('collage/images.json?v=' + _v)
        ]).then(function(results) {
            var socialsData = results[0];
            var statusData = results[1];
            var watermarkData = results[2];
            var imagesData = results[3];

            // Socials
            if (socialsData) {
                var socials = socialsData.socials || [];
                var contactEl = document.getElementById('contact-links');
                var footerEl = document.getElementById('footer-socials');
                socials.forEach(function(s) {
                    var card = document.createElement('a');
                    card.href = s.url; card.className = 'contact-card'; card.target = '_blank'; card.rel = 'noopener';
                    card.innerHTML = '<span class="contact-card-icon">' + (socialIcons[s.icon] || '&#10022;') + '</span><div class="contact-card-text"><h3>' + s.name + '</h3><p>' + (socialDescriptions[s.icon] || 'Visit my profile') + '</p></div><span class="contact-card-arrow">&rarr;</span>';
                    contactEl.appendChild(card);
                    var fl = document.createElement('a'); fl.href = s.url; fl.textContent = s.name; fl.target = '_blank'; fl.rel = 'noopener';
                    footerEl.appendChild(fl);
                });
            }

            // Commission status
            applyStatus(statusData ? (statusData.status || 'waitlist') : 'waitlist');

            // Watermark
            applyWatermark(watermarkData);

            // Gallery
            if (imagesData) buildGallery(imagesData);
            else document.getElementById('empty-state').style.display = 'block';
        });

        function applyStatus(status) {
            var el = document.getElementById('status-text');
            if (!el) return;
            el.textContent = status.toUpperCase();
            var cls = { open: 'status-open', closed: 'status-closed', full: 'status-full', waitlist: 'status-waitlist', paused: 'status-paused' };
            ['status-open','status-closed','status-full','status-waitlist','status-paused','status-slots'].forEach(function(c) { el.classList.remove(c); });
            el.classList.add(cls[status] || (status.toLowerCase().indexOf('slot') !== -1 ? 'status-slots' : 'status-waitlist'));
        }

        function applyWatermark(cfg) {
            var text = (cfg && cfg.text || 'atomicalmoon').toUpperCase();
            var opacity = cfg && cfg.opacity !== undefined ? cfg.opacity : 0.15;
            var svg = '<svg xmlns="http://www.w3.org/2000/svg" width="220" height="120"><text x="50%" y="50%" text-anchor="middle" dominant-baseline="middle" font-family="Inter,Arial,sans-serif" font-size="14" font-weight="800" fill="%23433e38" transform="rotate(-25 110 60)" letter-spacing="2">' + text + '</text></svg>';
            document.documentElement.style.setProperty('--watermark-pattern', 'url("data:image/svg+xml,' + encodeURIComponent(svg) + '")');
            document.documentElement.style.setProperty('--watermark-opacity', opacity);
        }

        // Slideshow
        (function() {
            var slides = document.querySelectorAll('.hero-slideshow .slide');
            if (!slides.length) return;
            var cur = 0;
            setInterval(function() { slides[cur].classList.remove('active'); cur = (cur + 1) % slides.length; slides[cur].classList.add('active'); }, 6000);
        })();

        // Smooth scroll
        document.querySelectorAll('a[href^="#"]').forEach(function(a) {
            a.addEventListener('click', function(e) {
                e.preventDefault();
                var t = document.querySelector(this.getAttribute('href'));
                if (t) t.scrollIntoView({ behavior: 'smooth' });
                document.getElementById('nav-links').classList.remove('open');
            });
        });

        // Nav scroll + parallax + back to top (single rAF handler)
        var navEl = document.getElementById('main-nav');
        var heroSlideshow = document.querySelector('.hero-slideshow');
        var bttBtn = document.getElementById('back-to-top');
        var scrollTick = false;
        var heroH = window.innerHeight;
        window.addEventListener('scroll', function() {
            if (!scrollTick) { scrollTick = true; requestAnimationFrame(function() {
                var sy = window.scrollY;
                navEl.classList.toggle('scrolled', sy > 40);
                if (heroSlideshow && sy < heroH) heroSlideshow.style.transform = 'translate3d(0,' + (sy * 0.35) + 'px,0)';
                bttBtn.classList.toggle('visible', sy > heroH * 0.8);
                scrollTick = false;
            }); }
        }, { passive: true });

        bttBtn.addEventListener('click', function() { window.scrollTo({ top: 0, behavior: 'smooth' }); });
        document.getElementById('nav-hamburger').addEventListener('click', function() { document.getElementById('nav-links').classList.toggle('open'); });

        // Reveal
        var obs = new IntersectionObserver(function(entries) {
            entries.forEach(function(e) { if (e.isIntersecting) { e.target.classList.add('visible'); obs.unobserve(e.target); } });
        }, { threshold: 0.1, rootMargin: '0px 0px -30px 0px' });
        document.querySelectorAll('.reveal').forEach(function(el) { obs.observe(el); });

        // ===== GALLERY =====
        var masonry = document.getElementById('masonry');
        var filterBar = document.getElementById('filter-bar');
        var countEl = document.getElementById('gallery-count');
        var emptyEl = document.getElementById('empty-state');
        var searchInput = document.getElementById('gallery-search');
        var allTagsSeen = {};
        var tagCounts = {};
        var tagColors = {};
        var allItems = [];
        var allFilenames = [];
        var allPixelArt = [];
        var activeTag = 'all';
        var lbIndex = 0;

        function parseTags(fn) {
            var name = fn.replace(/\.[^.]+$/, '');
            var parts = name.split('_');
            if (parts.length > 1 && /^\d+$/.test(parts[parts.length - 1])) parts.pop();
            return parts.map(function(t) { return t.toLowerCase(); });
        }

        function buildGallery(data) {
            var images = data.images || [];
            tagColors = data.tags || {};
            if (!images.length) { emptyEl.style.display = 'block'; return; }

            // Build all items with DocumentFragment (single DOM write)
            var frag = document.createDocumentFragment();

            images.forEach(function(filename, idx) {
                var tags = parseTags(filename);
                tags.forEach(function(t) {
                    allTagsSeen[t] = true;
                    tagCounts[t] = (tagCounts[t] || 0) + 1;
                });
                var isCommission = tags.indexOf('commission') !== -1;

                var item = document.createElement('div');
                item.className = 'masonry-item loading' + (isCommission ? ' is-commission' : '');
                item.setAttribute('data-tags', tags.join(','));
                item.setAttribute('data-idx', idx);

                var img = document.createElement('img');
                img.src = 'collage/images/' + filename;
                img.alt = filename;
                img.loading = 'lazy';
                img.decoding = 'async';

                // Staggered fade-in (cap at 600ms)
                (function(el, i) {
                    img.onload = function() {
                        setTimeout(function() { el.classList.remove('loading'); el.classList.add('loaded'); }, Math.min(i * 60, 600));
                    };
                })(item, idx);

                img.onerror = function() {
                    item.classList.remove('loading'); img.style.display = 'none';
                    var err = document.createElement('div');
                    err.style.cssText = 'padding:2rem 1rem;text-align:center;font-size:0.7rem;font-weight:700;color:var(--text-muted);background:var(--bg-vanilla);border-radius:10px;border:1px dashed var(--border);min-height:120px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:0.3rem;';
                    err.innerHTML = '<span style="font-size:1.5rem;opacity:0.3;">&#10006;</span>Image not found';
                    item.insertBefore(err, item.firstChild);
                };

                var isPixelArt = tags.some(function(t) { return /^\d+x\d+$/.test(t); });
                if (isPixelArt) img.style.imageRendering = 'pixelated';

                var tagContainer = document.createElement('div');
                tagContainer.className = 'item-tags';
                tags.forEach(function(t) {
                    var span = document.createElement('span');
                    span.className = 'item-tag' + (t === 'commission' ? ' tag-commission' : '');
                    span.textContent = t;
                    var color = tagColors[t];
                    if (color && t !== 'commission') { span.style.background = color; span.style.color = '#fff'; }
                    tagContainer.appendChild(span);
                });

                item.appendChild(img);
                item.appendChild(tagContainer);
                frag.appendChild(item);
                allItems.push(item);
                allFilenames.push(filename);
                allPixelArt.push(isPixelArt);

                (function(i) { item.addEventListener('click', function() { openLightbox(i); }); })(idx);
            });

            // Single DOM write
            masonry.appendChild(frag);

            // Build filter buttons with counts
            var tagKeys = Object.keys(allTagsSeen).sort();
            var commIdx = tagKeys.indexOf('commission');
            if (commIdx > -1) { tagKeys.splice(commIdx, 1); tagKeys.unshift('commission'); }

            var allBtn = filterBar.querySelector('[data-tag="all"]');
            allBtn.innerHTML = 'All <span class="tag-count">(' + images.length + ')</span>';

            var btnFrag = document.createDocumentFragment();
            tagKeys.forEach(function(tag) {
                var btn = document.createElement('button');
                btn.className = 'filter-tag';
                btn.setAttribute('data-tag', tag);
                btn.innerHTML = tag + ' <span class="tag-count">(' + (tagCounts[tag] || 0) + ')</span>';
                var color = tagColors[tag];
                if (color && tag !== 'commission') { btn.setAttribute('data-color', color); btn.style.borderColor = color; btn.style.color = color; }
                btnFrag.appendChild(btn);
            });
            filterBar.insertBefore(btnFrag, searchInput);

            updateCount();
            bindFilters();

            // Apply hash filter on load
            var initTag = location.hash.replace('#', '');
            if (initTag && (allTagsSeen[initTag] || initTag === 'all')) setFilter(initTag);
        }

        // ===== LIGHTBOX =====
        var lightbox = document.getElementById('lightbox');
        var lbImg = document.getElementById('lightbox-img');
        var lbCounter = document.getElementById('lb-counter');

        function getVisibleIndices() {
            var vis = [];
            for (var i = 0; i < allItems.length; i++) {
                if (!allItems[i].classList.contains('hidden')) vis.push(i);
            }
            return vis;
        }

        function openLightbox(idx) {
            lbIndex = idx;
            showLightboxImage();
            lightbox.classList.add('open');
            document.body.style.overflow = 'hidden';
        }

        function showLightboxImage() {
            lbImg.classList.add('lb-loading');
            lbImg.src = 'collage/images/' + allFilenames[lbIndex];
            lbImg.style.imageRendering = allPixelArt[lbIndex] ? 'pixelated' : '';
            lbImg.onload = function() { lbImg.classList.remove('lb-loading'); };
            var vis = getVisibleIndices();
            lbCounter.textContent = (vis.indexOf(lbIndex) + 1) + ' / ' + vis.length;
        }

        function lbNav(dir) {
            var vis = getVisibleIndices();
            var cur = vis.indexOf(lbIndex);
            if (cur === -1) return;
            lbIndex = vis[(cur + dir + vis.length) % vis.length];
            showLightboxImage();
        }

        document.getElementById('lb-prev').addEventListener('click', function(e) { e.stopPropagation(); lbNav(-1); });
        document.getElementById('lb-next').addEventListener('click', function(e) { e.stopPropagation(); lbNav(1); });

        lightbox.addEventListener('click', function(e) {
            if (e.target === this || e.target.id === 'lightbox-close') {
                this.classList.remove('open');
                document.body.style.overflow = '';
            }
        });

        document.addEventListener('keydown', function(e) {
            if (lightbox.classList.contains('open')) {
                if (e.key === 'Escape') { lightbox.classList.remove('open'); document.body.style.overflow = ''; }
                else if (e.key === 'ArrowLeft') lbNav(-1);
                else if (e.key === 'ArrowRight') lbNav(1);
            }
            if ((e.ctrlKey || e.metaKey) && e.key === 's') e.preventDefault();
        });

        // Touch swipe
        (function() {
            var sx = 0, sy = 0, sw = false;
            lightbox.addEventListener('touchstart', function(e) {
                if (e.touches.length === 1) { sx = e.touches[0].clientX; sy = e.touches[0].clientY; sw = true; }
            }, { passive: true });
            lightbox.addEventListener('touchend', function(e) {
                if (!sw) return; sw = false;
                var dx = e.changedTouches[0].clientX - sx;
                if (Math.abs(dx) > 50 && Math.abs(dx) > Math.abs(e.changedTouches[0].clientY - sy)) {
                    dx > 0 ? lbNav(-1) : lbNav(1);
                }
            }, { passive: true });
        })();

        // ===== FILTER + SEARCH + URL HASH =====
        function setFilter(tag) {
            activeTag = tag;
            filterBar.querySelectorAll('.filter-tag').forEach(function(btn) {
                var isA = btn.getAttribute('data-tag') === activeTag;
                btn.classList.toggle('active', isA);
                var c = btn.getAttribute('data-color');
                if (isA && c) { btn.style.background = c; btn.style.color = '#fff'; btn.style.borderColor = c; }
                else if (c) { btn.style.background = ''; btn.style.color = c; btn.style.borderColor = c; }
                else { btn.style.background = ''; btn.style.color = ''; btn.style.borderColor = ''; }
            });
            allItems.forEach(function(item) {
                var tags = item.getAttribute('data-tags').split(',');
                item.classList.toggle('hidden', activeTag !== 'all' && tags.indexOf(activeTag) === -1);
            });
            history.replaceState(null, '', tag === 'all' ? location.pathname : '#' + tag);
            updateCount();
        }

        function bindFilters() {
            filterBar.addEventListener('click', function(e) {
                var btn = e.target.closest('.filter-tag');
                if (!btn) return;
                setFilter(btn.getAttribute('data-tag'));
                searchInput.value = '';
            });
        }

        // Debounced search
        var searchTimer;
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimer);
            var self = this;
            searchTimer = setTimeout(function() {
                var q = self.value.trim().toLowerCase();
                if (!q) {
                    setFilter(activeTag);
                    filterBar.querySelectorAll('.filter-tag').forEach(function(btn) { btn.style.display = ''; });
                    return;
                }
                filterBar.querySelectorAll('.filter-tag').forEach(function(btn) {
                    var tag = btn.getAttribute('data-tag');
                    btn.style.display = (tag === 'all' || tag.indexOf(q) !== -1) ? '' : 'none';
                });
                allItems.forEach(function(item) {
                    item.classList.toggle('hidden', item.getAttribute('data-tags').indexOf(q) === -1);
                });
                updateCount();
            }, 120);
        });

        function updateCount() {
            var v = 0;
            for (var i = 0; i < allItems.length; i++) { if (!allItems[i].classList.contains('hidden')) v++; }
            countEl.textContent = v + ' image' + (v !== 1 ? 's' : '');
        }

        window.addEventListener('hashchange', function() {
            var tag = location.hash.replace('#', '') || 'all';
            if (allTagsSeen[tag] || tag === 'all') setFilter(tag);
        });

        // Image protection
        document.addEventListener('contextmenu', function(e) { if (e.target.closest('.masonry-item') || e.target.closest('.lightbox') || e.target.tagName === 'IMG') e.preventDefault(); });
        document.addEventListener('dragstart', function(e) { if (e.target.tagName === 'IMG') e.preventDefault(); });

        // ===== CANVAS MOTES — smart pause =====
        var canvas = document.getElementById('bg-canvas');
        var ctx = canvas.getContext('2d');
        var isMobile = window.innerWidth < 768;
        var MOTE_COUNT = isMobile ? 18 : 35;
        var motes = [], motesRunning = true, canvasVisible = true;

        function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        function initMotes() {
            motes = [];
            for (var i = 0; i < MOTE_COUNT; i++) {
                motes.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, r: Math.random() * 2 + 0.5, alpha: Math.random() * 0.08 + 0.02, vy: -(Math.random() * 0.08 + 0.01), vx: (Math.random() - 0.5) * 0.04, pulse: Math.random() * Math.PI * 2, speed: Math.random() * 0.003 + 0.001 });
            }
        }
        function drawMotes() {
            if (!motesRunning || !canvasVisible) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            var isD = document.body.classList.contains('dark');
            var mc = isD ? '200, 50, 50' : '160, 158, 148';
            for (var i = 0; i < motes.length; i++) {
                var m = motes[i]; m.pulse += m.speed; m.y += m.vy; m.x += m.vx;
                var a = m.alpha + Math.sin(m.pulse) * 0.03;
                if (m.y < -10) m.y = canvas.height + 10; if (m.x < -10) m.x = canvas.width + 10; if (m.x > canvas.width + 10) m.x = -10;
                ctx.beginPath(); ctx.arc(m.x, m.y, m.r, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(' + mc + ', ' + Math.max(0, a) + ')'; ctx.fill();
                if (m.r > 1.2) { ctx.beginPath(); ctx.arc(m.x, m.y, m.r * 3.5, 0, Math.PI * 2); ctx.fillStyle = 'rgba(' + mc + ', ' + Math.max(0, a * 0.08) + ')'; ctx.fill(); }
            }
            requestAnimationFrame(drawMotes);
        }

        // Pause canvas when tab hidden or canvas scrolled out of view
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) motesRunning = false;
            else { motesRunning = true; if (canvasVisible) requestAnimationFrame(drawMotes); }
        });
        var canvasObs = new IntersectionObserver(function(entries) {
            canvasVisible = entries[0].isIntersecting;
            if (canvasVisible && motesRunning) requestAnimationFrame(drawMotes);
        }, { threshold: 0 });
        canvasObs.observe(canvas);

        var resizeTimer;
        window.addEventListener('resize', function() { clearTimeout(resizeTimer); resizeTimer = setTimeout(function() { resizeCanvas(); initMotes(); heroH = window.innerHeight; }, 200); });
        resizeCanvas(); initMotes(); drawMotes();
    </script>
</body>
</html>
